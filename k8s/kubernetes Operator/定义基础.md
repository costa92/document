# kubernetes Operator 入门练习



## 基本概念

**CRD (Custom Resource Definition):** 允许用户自定义 kubernetes 资源，是一个类型

**CR (Custom Resource)**: CRD 的一个具体实例

**Webhook:** 它本质上是 一种 HTTP 回调，会注册到 apiserver 上，在 apiserver 特定时间发生时，会查询到已注册的 webhook ，并把相应的信息转发过去。

按照处理的类型的不同，一般可以分为两类

	* 一类可能会修改传入对象, 称为 mutating webhook; 
	* 一类则会只读传入对象，称为 validating webhook

 **工作队列**: controller 的 核心组件。它会监控集群内的资源变化并对其进行处理。它使用工作队列来处理需要执行的任务，例如部署、更新、扩展等

控制器通常包括一下几部分：

* 监听器： 用户监视资源的变化，例如：Pod、Service、Deployment等。
* 队列： 用于存储需要处理的任务。
* 处理器： 从队列中获取任务并执行它们的组件。
* 调谐器： 用于调整处理器的数量，以确保任务能够及时处理完毕。
* 监控器：用于监控队列状态和处理器状态的组件，例如：记录日志、报告错误。



![1035234-20181020215539574-213176954.png](http://img.longqiuhong.com/picgo/img/fba88812608a43868f2b8fc21154b86e.png)



Kubernetes operator 开发简单例子: [sample-controller](https://github.com/kubernetes/sample-controller)